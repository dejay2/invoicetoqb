<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Invoice Tools</title>
  <link rel="stylesheet" href="styles.css?v=20240930" />
</head>
<body>
  <main class="container">
    <header>
      <h1>Invoice Toolkit</h1>
      <p>Choose a company to manage QuickBooks connections, reference data, and parsed invoices.</p>
    </header>

    <section id="global-status" class="status" hidden></section>

    <section class="selector-card">
      <div class="selector-field">
        <label for="company-select">Select a company</label>
        <select id="company-select" name="company">
          <option value="">Choose a company</option>
        </select>
      </div>
      <button id="add-company" type="button" class="primary-button">Add Company</button>
    </section>

    <section id="company-dashboard" class="company-dashboard" hidden>
      <nav class="tabs company-tabs" role="tablist">
        <button class="tab active" data-company-tab="company-settings" role="tab" aria-selected="true" aria-controls="company-settings">Company settings</button>
        <button class="tab" data-company-tab="add-invoices" role="tab" aria-selected="false" aria-controls="add-invoices">Add invoices / bills</button>
        <button class="tab" data-company-tab="vendor-settings" role="tab" aria-selected="false" aria-controls="vendor-settings">Vendor settings</button>
        <button class="tab" data-company-tab="account-settings" role="tab" aria-selected="false" aria-controls="account-settings">Account / category settings</button>
        <button class="tab" data-company-tab="to-review" role="tab" aria-selected="false" aria-controls="to-review">To review</button>
        <button class="tab" data-company-tab="archive" role="tab" aria-selected="false" aria-controls="archive">Archive</button>
      </nav>

      <section id="company-settings" class="company-panel active" role="tabpanel">
        <div class="panel-card">
          <h2>Connection</h2>
          <p id="connection-status" class="panel-summary">Select a company to view connection details.</p>
          <div class="panel-actions">
            <button id="connect-company" type="button" class="primary-button">Connect / Reconnect to QuickBooks</button>
            <button id="refresh-metadata" type="button" class="secondary-button">Refresh QuickBooks Data</button>
          </div>
        </div>
        <div class="panel-card">
          <h2>Business profile</h2>
          <p class="panel-summary">Share a short description of the business to guide AI account suggestions.</p>
          <form id="business-profile-form" class="company-edit-form">
            <div class="input-group">
              <label for="company-business-type">Business type</label>
              <input id="company-business-type" name="businessType" type="text" placeholder="e.g., Restaurant, Construction contractor" maxlength="120" />
            </div>
            <button id="business-profile-submit" type="submit" class="primary-button">Save profile</button>
          </form>
        </div>
        <div class="panel-card">
          <h2>OneDrive automation</h2>
          <p class="panel-summary">Monitor a OneDrive folder and import new invoices automatically for this company.</p>
          <form id="onedrive-settings-form" class="onedrive-form">
            <div class="input-group">
              <label for="onedrive-share-url">Sharing link (optional)</label>
              <input id="onedrive-share-url" name="shareUrl" type="url" placeholder="https://onedrive.live.com/..." autocomplete="off" />
              <span>Provide a sharing link or specify the Drive and folder details below.</span>
            </div>
            <div class="form-divider"><span>or</span></div>
            <div class="input-row">
              <div class="input-group">
                <label for="onedrive-drive-id">Drive ID</label>
                <input id="onedrive-drive-id" name="driveId" type="text" autocomplete="off" />
              </div>
              <div class="input-group">
                <label for="onedrive-folder-id">Folder ID</label>
                <input id="onedrive-folder-id" name="folderId" type="text" autocomplete="off" />
              </div>
            </div>
            <div class="input-group">
              <label for="onedrive-folder-path">Folder path (optional)</label>
              <input id="onedrive-folder-path" name="folderPath" type="text" placeholder="/Invoices/Incoming" autocomplete="off" />
              <span>Use when the folder ID is unknown. The path is relative to the drive root.</span>
            </div>
            <label class="checkbox-group">
              <input id="onedrive-enabled" name="enabled" type="checkbox" />
              <span>Enable automatic imports from this folder</span>
            </label>
            <div class="onedrive-actions">
              <button type="submit" id="onedrive-save" class="primary-button">Save OneDrive settings</button>
              <button type="button" id="onedrive-sync-now" class="secondary-button">Sync now</button>
              <button type="button" id="onedrive-clear" class="danger-button">Disconnect</button>
            </div>
          </form>
          <dl class="onedrive-status" id="onedrive-status" hidden>
            <div>
              <dt>Status</dt>
              <dd id="onedrive-status-state">Not connected</dd>
            </div>
            <div>
              <dt>Folder</dt>
              <dd id="onedrive-status-folder">—</dd>
            </div>
            <div>
              <dt>Last sync</dt>
              <dd id="onedrive-status-last-sync">—</dd>
            </div>
            <div>
              <dt>Last result</dt>
              <dd id="onedrive-status-result">—</dd>
            </div>
          </dl>
        </div>
      </section>

      <section id="add-invoices" class="company-panel" role="tabpanel" hidden>
        <div class="panel-card">
          <h2>Add invoices or bills</h2>
          <p class="panel-summary">Drag and drop files or click the surface below to select multiple invoices at once. Parsed results are routed to the To Review tab.</p>
          <div id="invoice-drop-zone" class="drop-zone" role="button" tabindex="0">
            <input id="invoice-upload-input" class="visually-hidden" type="file" accept=".pdf,.png,.jpg,.jpeg,.heic,.tif,.tiff,.txt,.doc,.docx,.json,.xml" multiple />
            <div class="drop-zone-content">
              <p class="drop-zone-title">Drag and drop files here</p>
              <p class="drop-zone-subtitle">or click to add file(s)</p>
            </div>
          </div>
          <ul id="upload-status-list" class="upload-status-list">
            <li class="empty">No uploads yet.</li>
          </ul>
        </div>
      </section>

      <section id="vendor-settings" class="company-panel" role="tabpanel" hidden>
        <div class="panel-card">
          <h2>Vendors</h2>
          <div class="panel-toolbar">
            <button id="import-vendor-defaults" type="button" class="secondary-button">Import suggested defaults</button>
          </div>
          <ul id="vendor-list" class="entity-list">
            <li class="empty">Select a company to load vendor details.</li>
          </ul>
        </div>
      </section>

      <section id="account-settings" class="company-panel" role="tabpanel" hidden>
        <div class="panel-card">
          <h2>Accounts &amp; Categories</h2>
          <ul id="account-list" class="entity-list">
            <li class="empty">Select a company to load account details.</li>
          </ul>
        </div>
      </section>

      <section id="to-review" class="company-panel" role="tabpanel" hidden>
        <div class="panel-card">
          <h2>To Review</h2>
          <p class="panel-summary">Invoices awaiting manual checks before export are listed below.</p>
          <div class="table-wrapper">
            <table class="review-table">
              <thead>
                <tr>
                  <th scope="col">Invoice</th>
                  <th scope="col">Invoice date</th>
                  <th scope="col">Vendor</th>
                  <th scope="col">Account</th>
                  <th scope="col">Total ex VAT</th>
                  <th scope="col">VAT</th>
                  <th scope="col">Grand total</th>
                  <th scope="col">Actions</th>
                </tr>
              </thead>
              <tbody id="review-table-body">
                <tr class="empty-row">
                  <td colspan="8">No invoices pending review.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="archive" class="company-panel" role="tabpanel" hidden>
        <div class="panel-card">
          <h2>Archive</h2>
          <p class="panel-summary">Invoices parsed with Gemini are stored here until they are moved for review or removed.</p>
          <div class="table-wrapper">
            <table class="archive-table">
              <thead>
                <tr>
                  <th scope="col">Invoice</th>
                  <th scope="col">Vendor</th>
                  <th scope="col">Invoice date</th>
                  <th scope="col">Total</th>
                  <th scope="col">Actions</th>
                </tr>
              </thead>
              <tbody id="archive-table-body">
                <tr class="empty-row">
                  <td colspan="5">No archived invoices yet.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </section>
  </main>

  <script src="app.js?v=20240930" defer></script>
</body>
</html>
